<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>$if(title)$$title$$else$CV — $contacts.name$$endif$</title>

  $for(header-includes)$
  $header-includes$
  $endfor$

  $if(css)$
  $for(css)$
  <link rel="stylesheet" href="$css$" />
  $endfor$
  $endif$
</head>
<body>

<!-- Mobile header - only visible on small screens -->
<header class="mobile-header" aria-label="Mobile navigation">
  <a href="index.html" class="mobile-brand">erik hedlin</a>
  <button class="hamburger" id="hamburger-btn" aria-controls="mobile-drawer" aria-expanded="false" aria-label="Open menu">
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
  </button>
</header>

<!-- Off-canvas drawer for mobile -->
<div class="drawer-backdrop" id="drawer-backdrop"></div>
<div class="mobile-drawer" id="mobile-drawer" aria-hidden="true">
  <div class="drawer-header">
    <button class="drawer-close" id="drawer-close" aria-label="Close menu">×</button>
  </div>
  <div class="drawer-content" id="drawer-content"></div>
</div>

<div class="frame cv-page">
  <aside class="rail" aria-label="Primary" id="desktop-rail">
    <div class="brand">
      <a href="index.html" class="name">erik hedlin</a>
      <div style="margin-top: 8px;">
        <a href="cv.html" style="font-size: 12px; color: #666; text-decoration: none; font-weight: 600;">cv</a>
      </div>
    </div>

    <nav class="menu" aria-label="Navigation">
      <div class="menu-section">
        <ul></ul>
      </div>
      <div class="menu-section">
        <ul class="secondary"></ul>
      </div>
    </nav>
  </aside>

  <main class="cv-main">
    <div class="cv-container">
      <!-- Header -->
      <header class="cv-header">
        <div class="cv-name">$contacts.name$</div>
        <div class="cv-title">
          $if(contacts.title)$$contacts.title$$elseif(position)$$position$$else$Data Scientist$endif$
        </div>
        <div class="cv-contacts">
          $if(contacts.email)$
          <a href="mailto:$contacts.email$" class="contact-icon" title="$contacts.email$">
            <img src="icons/gmail-svgrepo-com.svg" alt="Email" style="width: 16px; height: 16px; vertical-align: middle;">
          </a>
          $endif$
          $if(contacts.github.url)$
          <a href="$contacts.github.url$" class="contact-icon" title="GitHub">
            <img src="icons/github-142-svgrepo-com.svg" alt="GitHub" style="width: 16px; height: 16px; vertical-align: middle;">
          </a>
          $endif$
          $if(contacts.linkedin.url)$
          <a href="$contacts.linkedin.url$" class="contact-icon" title="LinkedIn">
            <img src="icons/linkedin-svgrepo-com.svg" alt="LinkedIn" style="width: 16px; height: 16px; vertical-align: middle;">
          </a>
          $endif$
          $if(contacts.website.url)$
          <a href="$contacts.website.url$" class="contact-icon" title="Website">
            <img src="icons/website-ui-web-svgrepo-com.svg" alt="Website" style="width: 16px; height: 16px; vertical-align: middle;">
          </a>
          $endif$
          $if(contacts.address)$
          <span style="margin-left: 12px;">$contacts.address$</span>
          $endif$
        </div>
      </header>

      <!-- Tagline -->
      $if(tagline)$
      <div class="cv-tagline">
        $tagline$
      </div>
      $endif$

      <div class="cv-content">
        <!-- Left column: Experience -->
        <div class="main-content">
          <section class="cv-sec">
            <h2>Experience</h2>
            <div style="text-align: left; margin-bottom: 10px;">
              <button id="toggle-all" style="font-size: 11px; padding: 2px 8px; background: #f0f0f000; border: 0px solid #cccccc00; cursor: pointer; border-radius: 0px; color: #666;">Expand All</button>
            </div>

            $for(jobs)$
            <div class="job-entry">
              <div class="job-title">$it.position$</div>
              <div class="job-company">
                $if(it.company.link)$<a href="$it.company.link$">$it.company.name$</a>$else$$it.company.name$$endif$
              </div>
              <div class="job-period">
                $if(it.from)$$it.from$$endif$ — $if(it.to)$$it.to$$endif$,$if(it.location)$ $it.location$$endif$
              </div>
              $if(it.description)$
              <ul class="job-bullets">
                $for(it.description)$
                <li class="job-bullet-item">
                  <div class="bullet-header" $if(it.skills)$data-skills="$for(it.skills)$$it$$sep$,$endfor$"$endif$>
                    <span class="bullet-toggle">›</span>
                    <span class="bullet-label">$it.label$</span>
                    $if(it.skills)$
                    <div class="inline-skill-badges">
                      $for(it.skills)$
                      <span class="inline-skill-badge">$it$</span>
                      $endfor$
                    </div>
                    $endif$
                  </div>
                  <div class="bullet-content">
                    $if(it.items)$
                    <ul class="tree-list">
                      $for(it.items)$
                      <li class="tree-item">$it$</li>
                      $endfor$
                    </ul>
                    $else$
                    $it.text$
                    $endif$
                  </div>
                </li>
                $endfor$
              </ul>
              $endif$
            </div>
            $endfor$
          </section>

          $if(publications)$
          <section class="cv-sec">
            <h2>Publications</h2>
            $for(publications)$
            <div class="publication-entry">
              <div class="publication-title">$it.title$</div>
              $if(it.authors)$<div class="publication-authors">$it.authors$</div>$endif$
              $if(it.journal)$<div class="publication-journal">$it.journal$</div>$endif$
              $if(it.year)$<div class="publication-year">$it.year$</div>$endif$
              $if(it.link)$<div class="publication-link"><a href="$it.link$" target="_blank">View Publication</a></div>$endif$
            </div>
            $endfor$
          </section>
          $endif$
        </div>

        <!-- Right column: Objective, Education, Skills, Publications -->
        <div class="sidebar">
          <!-- $if(objective)$
          <section class="cv-sec">
            <h2>Objective</h2>
            <p>$objective$</p>
          </section>
          $endif$ -->

          $if(education)$
          <section class="cv-sec">
            <h2>Education</h2>
            $for(education)$
            <div class="edu-entry">
              <div class="edu-school">
                $if(it.place.link)$<a href="$it.place.link$">$it.place.name$</a>$else$$it.place.name$$endif$
              </div>
              <div class="edu-period">
                $if(it.from)$$it.from$$endif$ - $if(it.to)$$it.to$$endif$,$if(it.location)$ $it.location$$endif$
              </div>
              <div class="edu-degree">
                $if(it.degree)$$it.degree$$endif$$if(it.major)$ in $it.major$$endif$
              </div>
            </div>
            $endfor$
          </section>
          $endif$

          $if(skills)$
          <section class="cv-sec">
            <h2>Skills/Exposure</h2>
            <div class="skills-basket">
              $for(skills)$
              <span class="skill-badge" data-skill="$it$">$it$</span>
              $endfor$
            </div>
          </section>
          $endif$

          $if(achievements)$
          <section class="cv-sec">
            <h2>Projects</h2>
            $for(achievements)$
            <div class="project-entry" $if(it.tools)$data-skills="$for(it.tools)$$it$$sep$,$endfor$"$endif$>
              <div class="project-title">$it.name$</div>
              <div class="project-desc">$it.description$</div>
              $if(it.tools)$
              <div class="project-badges">
                $for(it.tools)$
                <span class="project-badge">$it$</span>
                $endfor$
              </div>
              $endif$
            </div>
            $endfor$
          </section>
          $endif$
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Quarto/Pandoc will insert include-after-body here -->
$for(include-after-body)$
$include-after-body$
$endfor$

<script src="mobile-nav.js"></script>

<script>
// Expandable CV bullets - optimized with single toggle
(function() {
  let allExpanded = false;
  
  // Use event delegation for better performance
  document.addEventListener('click', function(e) {
    // Handle bullet header clicks
    if (e.target.closest('.bullet-header')) {
      const header = e.target.closest('.bullet-header');
      const toggle = header.querySelector('.bullet-toggle');
      const content = header.nextElementSibling;
      
      header.classList.toggle('expanded');
      toggle.classList.toggle('expanded');
      content.classList.toggle('expanded');
      
      // Update button text based on current state
      updateToggleButton();
    }
    
    // Handle toggle all button
    if (e.target.id === 'toggle-all') {
      const headers = document.querySelectorAll('.bullet-header');
      const toggles = document.querySelectorAll('.bullet-toggle');
      const contents = document.querySelectorAll('.bullet-content');
      
      if (!allExpanded) {
        // Expand all
        headers.forEach(el => el.classList.add('expanded'));
        toggles.forEach(el => el.classList.add('expanded'));
        contents.forEach(el => el.classList.add('expanded'));
        e.target.textContent = 'Collapse All';
        allExpanded = true;
      } else {
        // Collapse all
        headers.forEach(el => el.classList.remove('expanded'));
        toggles.forEach(el => el.classList.remove('expanded'));
        contents.forEach(el => el.classList.remove('expanded'));
        e.target.textContent = 'Expand All';
        allExpanded = false;
      }
    }
  });
  
  // Update toggle button text based on current state
  function updateToggleButton() {
    const button = document.getElementById('toggle-all');
    if (!button) return;
    
    const expandedCount = document.querySelectorAll('.bullet-content.expanded').length;
    const totalCount = document.querySelectorAll('.bullet-content').length;
    
    if (expandedCount === totalCount && totalCount > 0) {
      button.textContent = 'Collapse All';
      allExpanded = true;
    } else if (expandedCount === 0) {
      button.textContent = 'Expand All';
      allExpanded = false;
    }
  }
})();

// Skill highlighting interactions
(function() {
  // Simple mobile detection
  const isMobile = window.innerWidth <= 768 || 'ontouchstart' in window;
  
  // Skip hover interactions on mobile devices
  if (isMobile) {
    return;
  }
  
  // Helper function to highlight skills
  function highlightSkills(skillsList) {
    // Reset all badges first
    document.querySelectorAll('.skill-badge').forEach(badge => {
      badge.classList.remove('skill-highlighted', 'skill-dimmed');
    });
    
    if (skillsList && skillsList.length > 0) {
      const skills = skillsList.split(',').map(s => s.trim());
      
      // Highlight matching skills
      document.querySelectorAll('.skill-badge').forEach(badge => {
        const skillName = badge.dataset.skill;
        if (skills.includes(skillName)) {
          badge.classList.add('skill-highlighted');
        } else {
          badge.classList.add('skill-dimmed');
        }
      });
    }
  }
  
  // Reset all highlights
  function resetHighlights() {
    document.querySelectorAll('.skill-badge').forEach(badge => {
      badge.classList.remove('skill-highlighted', 'skill-dimmed');
    });
  }
  
  // Add hover listeners to job bullet headers
  document.querySelectorAll('.bullet-header[data-skills]').forEach(header => {
    header.addEventListener('mouseenter', function() {
      highlightSkills(this.dataset.skills);
    });
    header.addEventListener('mouseleave', resetHighlights);
  });
  
  // Add hover listeners to project entries
  document.querySelectorAll('.project-entry[data-skills]').forEach(entry => {
    entry.addEventListener('mouseenter', function() {
      highlightSkills(this.dataset.skills);
    });
    entry.addEventListener('mouseleave', resetHighlights);
  });
  
  // Hover over skill badge to see where it's used
  document.querySelectorAll('.skill-badge').forEach(badge => {
    badge.addEventListener('mouseenter', function() {
      const skill = this.dataset.skill;
      
      // Add visual emphasis to all elements that use this skill
      document.querySelectorAll('[data-skills]').forEach(element => {
        if (element.dataset.skills && element.dataset.skills.includes(skill)) {
          // For job bullet headers
          if (element.classList.contains('bullet-header')) {
            element.style.backgroundColor = 'rgba(200, 200, 200, 0.3)';
            element.style.borderLeft = '3px solid #a8a8a8';
            element.style.paddingLeft = '5px';
            element.style.marginLeft = '-8px';
          }
          // For project entries
          else if (element.classList.contains('project-entry')) {
            element.style.backgroundColor = 'rgba(200, 200, 200, 0.3)';
            element.style.borderLeft = '3px solid #a8a8a8';
            element.style.paddingLeft = '8px';
            element.style.marginLeft = '-8px';
          }
        }
      });
      
      // Keep this badge highlighted
      this.classList.add('skill-highlighted');
    });
    
    badge.addEventListener('mouseleave', function() {
      // Reset all styles
      document.querySelectorAll('[data-skills]').forEach(element => {
        element.style.backgroundColor = '';
        element.style.borderLeft = '';
        element.style.paddingLeft = '';
        element.style.marginLeft = '';
      });
      
      // Remove highlight from this badge
      this.classList.remove('skill-highlighted');
    });
    
    // Click to expand highlighted sections
    badge.addEventListener('click', function() {
      const skill = this.dataset.skill;
      
      // Find all bullet headers that use this skill and expand them
      document.querySelectorAll('.bullet-header[data-skills]').forEach(header => {
        if (header.dataset.skills && header.dataset.skills.includes(skill)) {
          const toggle = header.querySelector('.bullet-toggle');
          const content = header.nextElementSibling;
          
          // Only expand if not already expanded
          if (!header.classList.contains('expanded')) {
            header.classList.add('expanded');
            toggle.classList.add('expanded');
            content.classList.add('expanded');
          }
        }
      });
      
      // Update the toggle all button text
      updateToggleButton();
    });
  });
})();
</script>

</body>
</html>
